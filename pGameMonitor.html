<html>
    <head>
        <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
        <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.css">
        <link rel="stylesheet" href="./css/chat.css">
    </head>
    <body>
        <div data-role="page" style="background:#CCCCFF;">
            <div data-role="content" class="ui-content" role="main">
                <div class="main-content">
                    <!-- 遊戲結果 -->
                    <div id="gameResultTable" style="padding:0 10px; height:350px; overflow:auto; background:white; border-radius: 5px;">
                    </div>
                    <br><br>
                    <!-- 遊戲資訊 -->
                    <table class="center">
                        <tr>
                            <td>Pid</td>
                            <td id="Pid"></td>
                        </tr>
                        <tr>
                            <td>Number of student</td>
                            <td id="numOfStudent"></td>
                        </tr>

                        <!--
                        <tr>
                            <td><input id="btn_Start" type="button" value="Start Game!" onclick="startGame()"></td>
                            <td><input id="btn_End" type="button" value="End Game!" onclick="endGame()" disabled></td>
                        </tr>
                        -->
                        <tr>
                            <td id="gameResult"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </body>
<!-- 開始遊戲與結束遊戲的function -->
<script>
    $(document).ready(function() { 
        poll();
    });
    function startGame(){
        document.getElementById('btn_Start').disabled = true;
        document.getElementById('btn_End').disabled = false;
        Pid = $("#Pid").text();
        $.ajax({
            url: "./function/ajax-server.php",
            type: "POST",
            data: { action: "startPGame", Pid: Pid },
            success: function(r) {
            },
        });
    }
    function endGame(){
        
        document.getElementById('btn_Start').disabled = false;
        document.getElementById('btn_End').disabled = true;
    }
    function poll() {
        room = $("#Pid").text();
        $.ajax({
                url: "./function/ajax-server.php",
                type: "POST",
                data: { action: "poll2", room: room },
                success: function(r) {
                    $("#gameResultTable").html(r);
                },
            });
        setTimeout(poll, 1000);
    }
</script>
<!-- 從URL中找出遊戲的Pid -->
<script>
    var url = location.href;
    if(url.indexOf('?')!=-1){
        var Pid = "";
        var ary = url.split('?')[1].split('&');
        for(i=0;i<=ary.length-1;i++)
        {
            if(ary[i].split('=')[0] == 'Pid')
                Pid = ary[i].split('=')[1];
        }
    }
    htmls = ''+Pid;
    document.getElementById("Pid").innerHTML += htmls;
</script>
<!-- 找出遊戲資訊 -->
<script>
    $.ajax({
    url: "./function/config.php?method=showPGameInfo&Pid="+Pid,
    dataType: "json",
    success: function (data) {
        var numOfStudent = data[0];
        document.getElementById("numOfStudent").innerHTML += ""+numOfStudent;
    },
    error:function(err){console.log(err)}
    });
</script>
<br>
<!-- 遊戲倒數計時 -->
<!--
<label>Time: </label>
<label class="text-center" id="count-down-timer"></label>
<script type="text/javascript">
    function paddedFormat(num) {
        return num < 10 ? "0" + num : num; 
    }
    function startCountDown(duration, element) {
        let secondsRemaining = duration;
        let sec = 0;

        let countInterval = setInterval(function () {
            sec = parseInt(secondsRemaining % 60);
            element.textContent = `${paddedFormat(sec)}`;
            secondsRemaining = secondsRemaining - 1;
            if (secondsRemaining < 0) { clearInterval(countInterval) };

        }, 1000);
    }
    window.onload = function () {
        let time_seconds = 10;      //時間在這裡，之後要從資料庫撈
        let duration = time_seconds;

        element = document.querySelector('#count-down-timer');
        element.textContent = `${paddedFormat(time_seconds)}`;

        startCountDown(--duration, element);
    };
</script>-->
<!-- 遊戲倒數計時 -->
</html>