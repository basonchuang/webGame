<html>
    <head>
        <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
        <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>
        <meta charset="utf-8">
        <link rel="stylesheet" href="./css/chat.css">
        <script>
            $(function(){
                dialog = $("#dialog-createGuessNumberGame").dialog({
                    autoOpen: false,
                    height: 600,
                    width: 400,
                    modal: true,
                    buttons: {
                        "Create a Guess Number Game": addGame,
                        Cancel: function() {
                        dialog.dialog( "close" );
                        }
                    },
                    close: function() {
                        form[ 0 ].reset();
                    }
                    });
                    form = dialog.find( "form" ).on( "submit", function( event ) {
                        event.preventDefault();
                        addGame();
                    });
                $("#createGuessNumberGame").button().on( "click", function() {
                    dialog.dialog("open");
                });
            });
            function addGame(create = false){
                post_data = { action: "room" };
                if(create) {
                    new_room = Math.floor(Math.random() * Math.floor(10000));
                    post_data["new"] = new_room;
                }
                $.ajax({
                    url: "./function/ajax-server.php",
                    type: "POST",
                    data: post_data,
                    success: function(r) {
                        console.log(r);
                        /*
                        obj = JSON.parse(r);
                        list_rooms = "";
                        for(id in obj) {
                            list_rooms += "<option value='" + obj[id] + "'>CHAT ROOM : " + obj[id] + "</option>";
                        }
                        list_rooms += "<option value='create room'>======== CREATE A NEW ROOM ========</option>";
                        
                        $("#room-list").html(list_rooms).selectmenu("refresh", true);
                        room = $("#room").text();
                        if(room.trim() == "") {
                            $("#room").text("default-chat");
                        }
                        */
                        if(create) {
                            alert("CREATE A NEW GAME : " + new_room);
                            //$("#room").text($("#room-list").find(":selected").val());
                        }
                    },
                });
            }
        </script>
    </head>
    <body>
        <button id="createGuessNumberGame">Create Guess Number Game</button>
        <!-- 輸入有幾個回合、P值、payoff、參與人數 -->
        <div id="dialog-createGuessNumberGame" title="Create Guess Number Game">
            <form>
                <fieldset>
                <label>Period</label>
                <input name="Rid" type="text" class="text ui-widget-content ui-corner-all" required>
                <br>
                <label>P(Fraction of Avg.)</label>
                <input name="pValue" type="text" class="text ui-widget-content ui-corner-all" required>
                <br>
                <label>Payoff</label>
                <input name="payoff" type="text" class="text ui-widget-content ui-corner-all" required>
                <br>
                <label>Group Size</label>
                <input name="numOfStudent" type="text" class="text ui-widget-content ui-corner-all" required>
                </fieldset>
            </form>
        </div>
        <br><br>
        <!-- 顯示遊戲列表 -->
        <table>
            <label>Select the game you want to start!</label>
            <select id="gameList" name="gameList" class="text ui-widget-content ui-corner-all">
                <option></option>
            </select>
            <br>
            <button id="startGame" class="text ui-widget-content ui-corner-all">Select Game!</button>
        </table>
        <script type="text/javascript">
            $.ajax({
            url: "./function/config.php?method=showGames",
            dataType: "json",
            success: function (data) {
                var htmls = '';
                for (var i=0 ; i< data.length ; i++){
                    htmls = '<option name=Game'+ i +'>' + data[i] + '</option>';
                    document.getElementById("gameList").innerHTML += htmls;
                }
            },
            error:function(err){console.log(err)}
            });
        </script>
        <!-- 選擇遊戲 -->
        <script>
            $(function(){
                $("#startGame").on("click",function(){
                    Sid = document.getElementById("gameList").value;
                    jumpToResult(Sid);
                });
            });
            function jumpToResult(Sid){
                url = "gameResult.html?Sid="+Sid;
                
                $.ajax({
                    url:"./function/config.php?method=startGame",
                    success: function(result){
                        window.location.href = url;
                    },error:function(err){console.log(err)}
                })
            }
        </script>
    </body>
</html>